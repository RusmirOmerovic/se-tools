#!/bin/bash
echo "🔐 GitHub Personal Access Token einrichten ..."

read -sp "GitHub Token eingeben (wird lokal gespeichert): " TOKEN
echo

# Automatisches Auslesen von Nutzername und Repo
REPO=$(basename -s .git "$(git config --get remote.origin.url)")
USER=$(git config --get remote.origin.url | sed -E 's|.*github.com[:/](.*)/.*|\1|')

# GitHub Pages für main aktivieren
curl -s -X PUT -H "Authorization: token $TOKEN" \
  https://api.github.com/repos/$USER/$REPO/pages \
  -d '{"source": {"branch":"main","path":"/"}}'

# GitHub Pages für preview (testing) aktivieren
curl -s -X PUT -H "Authorization: token $TOKEN" \
  https://api.github.com/repos/$USER/$REPO/pages \
  -d '{"source": {"branch":"preview","path":"/"}}'

# Token speichern
if [[ $SHELL == *"zsh" ]]; then
  echo "export GITHUB_TOKEN=\"$TOKEN\"" >> ~/.zshrc
  source ~/.zshrc
else
  echo "export GITHUB_TOKEN=\"$TOKEN\"" >> ~/.bash_profile
  source ~/.bash_profile
fi

echo "✅ Token gespeichert. Bitte Terminal neu starten oder 'source'-Befehl ausführen. Also -> source ~/.zshrc oder source ~/.bashrc je nach deiner Shell"