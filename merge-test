#!/bin/bash
# merge-test.sh
# Merge develop -> testing mit Sicherheits-Checks

set -e

# 1. Aktuelle Branches holen
git fetch origin --prune

# 2. Prüfen, ob wir auf develop sind
if [[ $(git branch --show-current) != "develop" ]]; then
  echo "❗ Du musst auf 'develop' sein! Nutze: git checkout develop"
  exit 1
fi

# 3. Prüfen, ob ungespeicherte Änderungen da sind
if ! git diff --quiet || ! git diff --cached --quiet; then
  echo "❗ Es gibt uncommitted Changes – bitte committen oder stashen."
  exit 1
fi

# 4. Sicher pushen
pushrepo   # Falls du lieber den Standard 'pushrepo' Flow nutzen willst

# 5. Branch wechseln & mergen
git checkout testing
git merge develop --no-ff -m "🔀 Merge develop into testing"

# 6. Pushen & zurück zu develop
git push origin testing
git checkout develop

echo "✅ Merge develop → testing abgeschlossen."
